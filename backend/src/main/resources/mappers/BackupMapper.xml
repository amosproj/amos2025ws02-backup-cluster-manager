<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bcm.mybatis.mapper.BackupMapper">

    <resultMap id="BackupMap" type="com.bcm.mybatis.model.Backup">
        <id     property="id"        column="id"/>
        <result property="clientId"  column="client_id"/>
        <result property="taskId"    column="task_id"/>
        <result property="startTime" column="start_time"/>
        <result property="stopTime"  column="stop_time"/>
        <result property="sizeBytes" column="size_bytes"/>
        <result property="state"     column="state"/>
        <result property="message"   column="message"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <sql id="BackupCols">
        id, client_id, task_id, start_time, stop_time, size_bytes, state, message, created_at
    </sql>

    <select id="findById" parameterType="java.util.UUID" resultMap="BackupMap">
        SELECT <include refid="BackupCols"/> FROM backups WHERE id = #{id}
    </select>

    <select id="findByClient" parameterType="java.util.UUID" resultMap="BackupMap">
        SELECT <include refid="BackupCols"/> FROM backups WHERE client_id = #{clientId} ORDER BY start_time DESC
    </select>

    <select id="findByTask" parameterType="java.util.UUID" resultMap="BackupMap">
        SELECT <include refid="BackupCols"/> FROM backups WHERE task_id = #{taskId} ORDER BY start_time DESC
    </select>

    <select id="findByState" parameterType="string" resultMap="BackupMap">
        SELECT <include refid="BackupCols"/> FROM backups WHERE state = #{state} ORDER BY start_time DESC
    </select>

    <select id="findBetween" resultMap="BackupMap">
        SELECT <include refid="BackupCols"/> FROM backups
        WHERE start_time BETWEEN #{param1} AND #{param2}
        ORDER BY start_time DESC
    </select>

    <insert id="insert" parameterType="com.bcm.mybatis.model.Backup">
        INSERT INTO backups (id, client_id, task_id, start_time, stop_time, size_bytes, state, message)
        VALUES (#{id}, #{clientId}, #{taskId}, #{startTime}, #{stopTime}, #{sizeBytes}, #{state}, #{message})
    </insert>

    <update id="update" parameterType="com.bcm.mybatis.model.Backup">
        UPDATE backups
        SET client_id = #{clientId},
            task_id = #{taskId},
            start_time = #{startTime},
            stop_time = #{stopTime},
            size_bytes = #{sizeBytes},
            state = #{state},
            message = #{message}
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="java.util.UUID">
        DELETE FROM backups WHERE id = #{id}
    </delete>
</mapper>
