@if (error()) {
  <div class="bg-red-600 text-white p-4 rounded-lg">Error: {{ error() }}</div>
}
<section class="h-full flex flex-col overflow-auto gap-2">

  <div class="relative flex-col flex-0">
    <!--      Header-->
    <div class="flex flex-col items-center justify-between md:flex-row gap-4">
      <div class="w-full flex items-center py-2">
        <label for="simple-search" class="sr-only">Search</label>
        <div class="relative w-full">
          <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <img src="search.svg"/>
          </div>
          <input type="text" id="simple-search"
                 (keyup)="handleSearch($event)"
                 class="block w-full p-2 h-10 text-foreground focus:ring-0 pl-12 text-sm outline-none rounded-lg bg-primary-2 border-none"
                 placeholder="Search" required="">
        </div>
      </div>
      <div
        class="flex  flex-col justify-end flex-shrink-0 w-full md:w-auto md:flex-row md:items-end gap-4">
        @if (addButtonTemplate == null) {
          @if (showAddButton) {
            <button
              type="button"
              (click)="onAddClick()"
              class="flex items-center justify-center hover:bg-primary-3 gap-2 px-4 py-2 h-10 text-sm font-medium text-foreground bg-primary-2 rounded-lg"
              [attr.aria-label]="addButtonText">
              <img src="plus.svg" alt=""/>
              {{ addButtonText }}
            </button>
          }
        } @else {
          <ng-container [ngTemplateOutlet]="addButtonTemplate"></ng-container>
        }
        @if (showDeleteButton) {
          <button
            type="button"
            (click)="onDeleteClick()"
            class="flex items-center justify-center hover:bg-primary-3 gap-2 px-4 py-2 h-10 text-sm font-medium text-foreground bg-primary-2 rounded-lg disabled:opacity-50"
            [disabled]="!hasSelection()"
          >
            <img src="trash.svg" alt=""/>
            Delete
          </button>
        }

        <!--Filter-->
        @if (showFilter) {
        <div class="flex items-center w-full md:w-auto">
          <button [id]="'filterDropdownButton-' + uniqueId" [attr.data-dropdown-toggle]="'filterDropdown-' + uniqueId"
                  class="flex items-center justify-center hover:bg-primary-3 gap-2 w-full px-4 py-2 h-10 text-sm font-medium text-foreground  rounded-lg bg-primary-2 "
                  type="button">
            <img src="filter.svg" class="w-6 h-6"/>
            Filter
            <img src="chevron-down.svg" class="w-6 h-6"/>
          </button>
          <!-- Dropdown menu -->
          <div [id]="'filterDropdown-' + uniqueId" class="z-10 hidden w-48 p-3 rounded-lg bg-primary-2 text-primary">
            <ul class="space-y-2 text-sm" aria-labelledby="dropdownDefault">
              @for (filter of tableFilters(); track filter.label) {
                <li class="flex items-center">
                  <input id="apple" type="checkbox" value=""
                         (change)="toggleFilter(filter)"
                         class="w-4 h-4 rounded text-foreground"/>
                  <label for="apple" class="ml-2 text-sm font-medium text-foreground">
                    {{ filter.label }}
                  </label>
                </li>
              }
            </ul>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
  <!--      Table-->
  <div class="relative overflow-auto flex-1 flex-col">
    <div class="rounded-lg overflow-auto max-h-full">
      <table class="w-full text-sm text-left rtl:text-right text-foreground-muted overflow-auto ">
        <thead class="text-xs sticky top-0 text-foreground-muted uppercase bg-primary-2">
        <tr>
        @if (showDeleteButton) {
          <th scope="col" class="px-6 py-3">
            <input
              type="checkbox"
              (change)="toggleSelectAll($event)"
              [checked]="allRowsSelected()"
              style="accent-color: grey;"
            />
          </th>
          }

          @for (column of tableColumns(); track column.field) {
            <th scope="col" class="px-6 py-3 cursor-pointer hover:bg-primary-3 select-none"
                (click)="handleSort(column.field)">
              <div class="flex items-center gap-2">
                {{ column.header }}
                <span class="text-base">{{ getSortIcon(column.field) }}</span>
              </div>
            </th>
          }
          @if (showActionsColumn) {
            <th scope="col" class="px-6 py-3">
              Actions
            </th>
          }
          @if (showToggleButton) {
          <th scope="col" class="px-6 py-3 cursor-pointer hover:bg-primary-3 select-none">
            <div class="flex items-center gap-2">
              Managed
            </div>
          </th>
          }
        </tr>
        </thead>
        <tbody class="overflow-scroll">
          @for (dataItem of tableData(); track dataItem.id) {
            <tr class="bg-primary-1 border-b border-primary-4 border-gray-200">

              @if (showDeleteButton) {
              <td class="px-6 py-4">
                <input
                  type="checkbox"
                  (change)="toggleRowSelection(dataItem, $event)"
                  [checked]="isRowSelected(dataItem)"
                  [disabled]="dataItem?.mode === 'cluster_manager'"
                  class="w-5 h-5 rounded border-gray-300 accent-gray-400 disabled:cursor-not-allowed disabled:opacity-50"
                />
              </td>
              }

              @for (column of tableColumns(); track column.field) {
                <td class="px-6 py-4">
                  @if (column.field === 'name') {
                    {{ getColumnValue(dataItem, column.field) }}
                    @if (dataItem?.mode === 'cluster_manager') {
                      <span class="bg-danger-soft border border-danger-subtle text-fg-danger-strong text-xs font-medium px-1.5 py-0.5 rounded">cm</span>
                     }
                  } @else if (column.field === 'status') {
                    <span [ngClass]="{
                      'text-green-400': getColumnValue(dataItem, column.field) === 'active',
                      'text-red-400': getColumnValue(dataItem, column.field) === 'inactive',
                      'text-orange-400': getColumnValue(dataItem, column.field) === 'shutting_down',
                      'text-blue-400': getColumnValue(dataItem, column.field) === 'restarting',
                      'text-yellow-400': getColumnValue(dataItem, column.field) === 'pending'
                    }">
                      {{ getColumnValue(dataItem, column.field) }}
                    </span>
                  } @else {
                    {{ getColumnValue(dataItem, column.field) }}
                  }

                </td>
              }
              @if (showActionsColumn && rowActions) {
                <td class="px-6 py-4">
                  <ng-container *ngTemplateOutlet="rowActions; context: { $implicit: dataItem }"></ng-container>
                </td>
              }
              @if (showToggleButton) {
                <td class="px-6 py-4">
                  <label class="inline-flex items-center cursor-pointer">
                    <input
                      type="checkbox"
                      class="sr-only peer"
                      [checked]="dataItem?.isManaged"
                      [disabled]="dataItem?.mode === 'cluster_manager'"
                      (change)="toggleManaged(dataItem)"
                    >
                    <div
                      class="relative w-11 h-6 rounded-full
                           bg-gray-400
                           peer-checked:bg-green-500
                           peer-disabled:bg-gray-300
                           peer-disabled:cursor-not-allowed
                           transition-colors
                           after:content-['']
                           after:absolute after:top-[2px] after:left-[2px]
                           after:h-5 after:w-5 after:rounded-full after:bg-white
                           after:transition-all
                           peer-checked:after:translate-x-full
                           peer-disabled:after:bg-gray-100"
                    ></div>
                  </label>
                </td>
              }

            </tr>
          }

        </tbody>
      </table>

      @for (row of (tableData()); track row.id) {
      } @empty {
        <div class="w-full flex justify-center items-center bg-primary-1 p-4 rounded-b-lg">
          No data found
        </div>
      }
      @if (tableDataLoading()) {
        <div class="w-full flex justify-center items-center bg-primary-1 p-4 rounded-b-lg">
          Loading...
        </div>
      }
    </div>
  </div>
  <nav class="flex items-center flex-column flex-wrap md:flex-row justify-between p-2 gap-2"
       aria-label="Table navigation">
      <span class="text-foreground md:w-auto">Showing Page <span
        class="font-semibold ">{{ currentPage }}</span> of <span
        class="font-semibold ">{{ totalPages }}</span> Pages </span>
    <div class="flex items-center gap-2">
      <select
        id="pageSize"
        [value]="itemsPerPage"
        [(ngModel)]="itemsPerPage"
        (ngModelChange)="onPageSizeChange($event)"
        (change)="onPageSizeChange($event)"
        class="appearance-none px-2 py-1 cursor-pointer text-foreground bg-primary-2 border-none rounded-lg focus:ring-0 outline-none hover:bg-primary-1"
        style="
          appearance: none;
          -webkit-appearance: none;
          -moz-appearance: none;
          background-image: none;
        ">
        @for (size of availablePageSizes; track size) {
          <option [value]="size">{{ size }}</option>
        }
      </select>
    </div>
    <ul class="inline-flex -space-x-px rtl:space-x-reverse bg-primary h-8">
      <li>
        <button
          (click)="previousPage()"
          [disabled]="currentPage===1"
          class="flex items-center justify-center px-3 h-8 ms-0 leading-tight bg-primary-2 hover:bg-primary-1 rounded-s-lg disabled:text-foreground-muted disabled:bg-primary-4">
          Previous
        </button>
      </li>
      @for (page of getPageNumbers(); track page) {
        <li>
          <button
            (click)="page > 0 && goToPage(page)"
            [class.active]="page === currentPage"
            [disabled]="page === -1"
            [ngClass]="{
            'bg-primary-1 text-foreground font-bold': page === currentPage,
            }"
            class="flex items-center justify-center px-3 h-8 ms-0 leading-tight bg-primary-2 hover:bg-primary-1">
            {{ page === -1 ? '...' : page }}
          </button>
        </li>
      }
      <li>
        <button
          (click)="nextPage()"
          [disabled]="currentPage===totalPages"
          class="flex items-center justify-center px-3 h-8 ms-0 leading-tight bg-primary-2 hover:bg-primary-1 disabled:text-foreground-muted disabled:bg-primary-4  rounded-r-lg ">
          Next
        </button>
      </li>
    </ul>
  </nav>
</section>



